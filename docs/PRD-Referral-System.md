# PRD: é›™å‘æ¨è–¦ç³»çµ±ï¼ˆReferral Systemï¼‰

## ğŸ“Š åŸ·è¡Œæ‘˜è¦

### æ¥­å‹™ç›®æ¨™
å»ºç«‹å®Œæ•´çš„é›™å‘æ¨è–¦æ©Ÿåˆ¶ï¼Œå¯¦ç¾å¹³å°ç¶²çµ¡æ•ˆæ‡‰æœ€å¤§åŒ–ï¼š
- **ç²å®¢ç›®æ¨™**ï¼šé™ä½ç²å®¢æˆæœ¬50%ï¼Œæ¨è–¦æ–°ç”¨æˆ¶ä½”æ¯”é”30%
- **è½‰æ›ç›®æ¨™**ï¼šæ¨è–¦è½‰æ›ç‡>20%ï¼Œæ¨è–¦ç”¨æˆ¶ç•™å­˜ç‡>85%
- **ç¶²çµ¡ç›®æ¨™**ï¼šå»ºç«‹è‡ªå¢é•·çš„ç”Ÿæ…‹ç³»çµ±ï¼Œç—…æ¯’ä¿‚æ•¸>1.2

### æˆåŠŸæŒ‡æ¨™ï¼ˆKPIsï¼‰
- æ¨è–¦æ–°ç”¨æˆ¶ä½”æ¯”ï¼š5% â†’ 30%
- æ¨è–¦è½‰æ›ç‡ï¼š>20%
- ç²å®¢æˆæœ¬ï¼ˆCACï¼‰ï¼šé™ä½50%
- æ¨è–¦ç”¨æˆ¶30å¤©ç•™å­˜ç‡ï¼š>85%
- ç¶²çµ¡å¯†åº¦ï¼šæ¯å€‹ç”¨æˆ¶å¹³å‡é€£æ¥2.5å€‹åˆä½œå¤¥ä¼´

## ğŸ¯ æ¥­å‹™èƒŒæ™¯

### å•é¡Œé™³è¿°
1. **å–®å‘é‚€è«‹é™åˆ¶**ï¼šç›®å‰åƒ…æ”¯æ´é¤å»³â†’ä¾›æ‡‰å•†é‚€è«‹ï¼Œç¼ºå°‘ä¾›æ‡‰å•†â†’é¤å»³çš„é€†å‘é‚€è«‹
2. **ç¼ºä¹æ¿€å‹µæ©Ÿåˆ¶**ï¼šæ²’æœ‰æ¨è–¦çå‹µï¼Œç”¨æˆ¶æ¨è–¦å‹•æ©Ÿä¸è¶³
3. **ç²å®¢æˆæœ¬éé«˜**ï¼šä¸»è¦ä¾è³´ä»˜è²»å»£å‘Šï¼Œç¼ºä¹æœ‰æ©Ÿå¢é•·
4. **é—œä¿‚ç®¡ç†è–„å¼±**ï¼šé‚€è«‹å¾Œç¼ºä¹é—œä¿‚ç¶­è­·å’Œå„ªåŒ–æ©Ÿåˆ¶

### æ©Ÿæœƒé»
- ç¾æœ‰é‚€è«‹ç³»çµ±åŸºç¤è‰¯å¥½ï¼ˆ8ä½é‚€è«‹ç¢¼æ©Ÿåˆ¶ï¼‰
- ä¾›æ‡‰å•†æœ‰å¼·çƒˆå®¢æˆ¶é–‹ç™¼éœ€æ±‚
- é¤å»³å¸Œæœ›ç™¼ç¾æ›´å¤šå„ªè³ªä¾›æ‡‰å•†
- å¹³å°å¯ä½œç‚ºä¿¡ä»»ä¸­ä»‹å»ºç«‹å¤šæ–¹é—œä¿‚

### ç«¶çˆ­å„ªå‹¢
- **é›™å‘äº’åˆ©**ï¼šä¸åŒæ–¼å–®å‘æ¨è–¦ï¼Œå‰µé€ é›™è´å±€é¢
- **è¡Œæ¥­å°ˆæ¥­æ€§**ï¼šæ·±åº¦ç†è§£é¤é£²ä¾›æ‡‰éˆéœ€æ±‚
- **ä¿¡ä»»æ©Ÿåˆ¶**ï¼šå¹³å°èƒŒæ›¸é™ä½åˆä½œé¢¨éšª

## ğŸ‘¥ ä½¿ç”¨è€…è§’è‰²èˆ‡éœ€æ±‚

### é¤å»³æ–¹æ¨è–¦éœ€æ±‚

#### æ¨è–¦ä¾›æ‡‰å•†å ´æ™¯
- **ç—›é»**ï¼šç¾æœ‰ä¾›æ‡‰å•†æœå‹™ä¸ä½³ï¼Œå°‹æ‰¾æ›¿ä»£æ–¹æ¡ˆ
- **å‹•æ©Ÿ**ï¼šç²å¾—æ¨è–¦çå‹µï¼Œå¹«åŠ©æ¥­ç•Œå¤¥ä¼´æ•¸ä½åŒ–
- **ç›®æ¨™**ï¼šæ¨è–¦å„ªè³ªä¾›æ‡‰å•†çµ¦å…¶ä»–é¤å»³ï¼Œå»ºç«‹è¡Œæ¥­è²è­½

#### æ¥å—ä¾›æ‡‰å•†æ¨è–¦å ´æ™¯
- **ç—›é»**ï¼šå°‹æ‰¾ç‰¹å®šå“é¡ä¾›æ‡‰å•†å›°é›£
- **å‹•æ©Ÿ**ï¼šç²å¾—å¯ä¿¡æ¨è–¦ï¼Œé™ä½è©¦éŒ¯æˆæœ¬
- **ç›®æ¨™**ï¼šé€šéåŒæ¥­æ¨è–¦æ‰¾åˆ°å„ªè³ªä¾›æ‡‰å•†

### ä¾›æ‡‰å•†æ–¹æ¨è–¦éœ€æ±‚

#### æ¨è–¦é¤å»³å ´æ™¯ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰
- **ç—›é»**ï¼šå®¢æˆ¶é–‹ç™¼å›°é›£ï¼Œç‡Ÿæ¥­é¡å¢é•·ç·©æ…¢
- **å‹•æ©Ÿ**ï¼šæ‹“å±•å®¢æˆ¶ç¾¤ï¼Œç©©å®šç‡Ÿæ”¶ä¾†æº
- **ç›®æ¨™**ï¼šæ¨è–¦å„ªè³ªé¤å»³å®¢æˆ¶çµ¦å…¶ä»–ä¾›æ‡‰å•†ï¼Œå»ºç«‹åˆä½œç¶²çµ¡

#### æ¥å—é¤å»³æ¨è–¦å ´æ™¯
- **ç—›é»**ï¼šè¢«å‹•ç­‰å¾…å®¢æˆ¶ä¸Šé–€ï¼Œç‡ŸéŠ·æ•ˆæœå·®
- **å‹•æ©Ÿ**ï¼šç²å¾—å„ªè³ªå®¢æˆ¶ç·šç´¢ï¼Œæå‡å“ç‰ŒçŸ¥ååº¦
- **ç›®æ¨™**ï¼šé€šéæ¨è–¦ç²å¾—ç›®æ¨™å®¢æˆ¶ç¾¤

### å¹³å°æ–¹åƒ¹å€¼ä¸»å¼µ
- **ç¶²çµ¡æ•ˆæ‡‰**ï¼šç”¨æˆ¶æ¨è–¦ç”¨æˆ¶ï¼Œè‡ªå¢é•·ç”Ÿæ…‹
- **é™æœ¬å¢æ•ˆ**ï¼šæ¸›å°‘å¸‚å ´æ¨å»£æˆæœ¬ï¼Œæå‡ç²å®¢æ•ˆç‡  
- **æå‡é»æ€§**ï¼šæ¨è–¦é—œä¿‚å¢åŠ ç”¨æˆ¶ç•™å­˜å’Œæ´»èºåº¦

## ğŸ”„ é›™å‘é‚€è«‹æ©Ÿåˆ¶è¨­è¨ˆ

### ç¾æœ‰é¤å»³â†’ä¾›æ‡‰å•†é‚€è«‹ï¼ˆå„ªåŒ–ï¼‰

#### ç•¶å‰æµç¨‹å›é¡§
1. é¤å»³åœ¨å¹³å°ç™¼èµ·é‚€è«‹
2. ç”Ÿæˆ8ä½é‚€è«‹ç¢¼ï¼ˆå¦‚ï¼šAB12CD34ï¼‰
3. ä¾›æ‡‰å•†ä½¿ç”¨é‚€è«‹ç¢¼è¨»å†Š
4. è‡ªå‹•å»ºç«‹æ¥­å‹™é—œä¿‚

#### å„ªåŒ–æ–¹æ¡ˆ

**æ‰¹é‡é‚€è«‹åŠŸèƒ½**ï¼š
```typescript
interface BatchInvitationRequest {
  suppliers: {
    companyName: string;
    contactEmail: string;
    contactPerson?: string;
    phone?: string;
    specialNote?: string;
  }[];
  invitationTemplate: string;
  expiryDays: number; // é è¨­30å¤©
}
```

**é‚€è«‹æ¨¡æ¿ç®¡ç†**ï¼š
- é è¨­æ¨¡æ¿ï¼šæ­£å¼é‚€è«‹ã€è©¦ç”¨é‚€è«‹ã€ç·Šæ€¥æ¡è³¼
- è‡ªå®šç¾©æ¨¡æ¿ï¼šæ”¯æ´å€‹æ€§åŒ–è¨Šæ¯
- å“ç‰ŒåŒ–å…ƒç´ ï¼šé¤å»³logoã€è¯çµ¡æ–¹å¼

**æ™ºèƒ½æ¨è–¦é‚€è«‹å°è±¡**ï¼š
- åŸºæ–¼æ¡è³¼æ­·å²æ¨è–¦ç›¸ä¼¼ä¾›æ‡‰å•†
- åœ°ç†ä½ç½®é„°è¿‘çš„ä¾›æ‡‰å•†
- åŒæ¥­é¤å»³åˆä½œéçš„ä¾›æ‡‰å•†

### æ–°å¢ä¾›æ‡‰å•†â†’é¤å»³é‚€è«‹ï¼ˆæ ¸å¿ƒæ–°åŠŸèƒ½ï¼‰

#### é‚€è«‹æµç¨‹è¨­è¨ˆ

**ç¬¬1æ­¥ï¼šå®¢æˆ¶ç™¼ç¾**
```typescript
interface CustomerDiscoveryRequest {
  targetCriteria: {
    locationRadius: number; // é…é€åŠå¾‘ï¼ˆå…¬é‡Œï¼‰
    restaurantTypes: string[]; // é¤å»³é¡å‹
    estimatedVolume: 'small' | 'medium' | 'large';
    productCategories: string[]; // ç›¸é—œå•†å“é¡åˆ¥
  };
  maxRecommendations: number; // æœ€å¤šæ¨è–¦æ•¸é‡
}
```

**ç¬¬2æ­¥ï¼šé‚€è«‹å®¢è£½åŒ–**
```typescript
interface RestaurantInvitationRequest {
  restaurantId: string;
  invitationMessage: string;
  specialOffers?: {
    discountPercentage?: number;
    freeDelivery?: boolean;
    creditTerms?: number; // å¸³æœŸå¤©æ•¸
    minimumOrder?: number;
  };
  productSamples?: {
    productId: string;
    sampleQuantity: number;
  }[];
}
```

**ç¬¬3æ­¥ï¼šé‚€è«‹ç™¼é€èˆ‡è¿½è¹¤**
- å¤šæ¸ é“ç™¼é€ï¼šEmailã€Lineã€æ‰‹æ©Ÿç°¡è¨Š
- é‚€è«‹ç‹€æ…‹ï¼šå·²ç™¼é€ã€å·²æŸ¥çœ‹ã€å·²å›æ‡‰ã€å·²æ¥å—ã€å·²æ‹’çµ•
- è‡ªå‹•è·Ÿé€²ï¼š3å¤©ã€7å¤©ã€14å¤©å¾Œè‡ªå‹•æé†’

#### é¤å»³æ¥å—é‚€è«‹æµç¨‹

**é‚€è«‹é©—è­‰é é¢**ï¼š
```
/auth/restaurant-invite?code={INVITE_CODE}
```

**å¿«é€Ÿè¨»å†Šæµç¨‹**ï¼š
- é å¡«é¤å»³åŸºæœ¬è³‡è¨Šï¼ˆåŸºæ–¼é‚€è«‹å…§å®¹ï¼‰
- ç°¡åŒ–é©—è­‰æµç¨‹ï¼ˆä¾›æ‡‰å•†èƒŒæ›¸ï¼‰
- ç›´æ¥å»ºç«‹ä¾›æ‡‰å•†é—œä¿‚

## ğŸ çå‹µæ©Ÿåˆ¶è¨­è¨ˆ

### æ¨è–¦è€…çå‹µæ–¹æ¡ˆ

#### é¤å»³æ¨è–¦ä¾›æ‡‰å•†çå‹µ
**å±¤ç´šå¼çå‹µçµæ§‹**ï¼š

```typescript
interface RestaurantReferralRewards {
  // Tier 1: æ¨è–¦æˆåŠŸè¨»å†Š
  registrationBonus: {
    amount: 500; // NT$500 å¹³å°é»æ•¸
    condition: "è¢«æ¨è–¦ä¾›æ‡‰å•†å®Œæˆè¨»å†Š";
  };
  
  // Tier 2: é¦–ç­†äº¤æ˜“
  firstOrderBonus: {
    percentage: 2; // é¦–ç­†è¨‚å–®é‡‘é¡2%å›é¥‹
    maxAmount: 2000; // æœ€é«˜NT$2,000
    condition: "æ¨è–¦ä¾›æ‡‰å•†å®Œæˆé¦–ç­†äº¤æ˜“";
  };
  
  // Tier 3: æŒçºŒåˆä½œ
  ongoingRewards: {
    percentage: 0.5; // æŒçºŒäº¤æ˜“0.5%å›é¥‹
    duration: 6; // æŒçºŒ6å€‹æœˆ
    condition: "ç¶­æŒæ´»èºäº¤æ˜“é—œä¿‚";
  };
}
```

#### ä¾›æ‡‰å•†æ¨è–¦é¤å»³çå‹µ
**å®¢æˆ¶é–‹ç™¼æ¿€å‹µ**ï¼š

```typescript
interface SupplierReferralRewards {
  // æ–°å®¢æˆ¶è¨»å†Šçå‹µ
  customerAcquisitionBonus: {
    amount: 1000; // NT$1,000 å¹³å°é»æ•¸
    condition: "æ¨è–¦é¤å»³å®Œæˆè¨»å†Šä¸¦é©—è­‰";
  };
  
  // é¦–ç­†äº¤æ˜“ä½£é‡‘å›é¥‹
  firstSaleCommission: {
    percentage: 3; // é¦–ç­†è¨‚å–®æ¯›åˆ©3%å›é¥‹
    maxAmount: 5000; // æœ€é«˜NT$5,000
    condition: "æ¨è–¦é¤å»³ä¸‹å–®è³¼è²·";
  };
  
  // é•·æœŸå®¢æˆ¶åƒ¹å€¼çå‹µ
  loyaltyBonus: {
    monthlyThreshold: 50000; // æœˆäº¤æ˜“é¡é”NT$50,000
    bonusPercentage: 1; // é¡å¤–1%ä½£é‡‘å›é¥‹
    condition: "æ¨è–¦å®¢æˆ¶æˆç‚ºé•·æœŸç©©å®šå®¢æˆ¶";
  };
}
```

### è¢«æ¨è–¦è€…å„ªæƒ æ–¹æ¡ˆ

#### æ–°ä¾›æ‡‰å•†å„ªæƒ 
```typescript
interface NewSupplierBenefits {
  // å¹³å°è²»ç”¨æ¸›å…
  platformFeeWaiver: {
    duration: 1; // é¦–æœˆå…å¹³å°æ‰‹çºŒè²»
    feeTypes: ['transaction', 'listing'];
  };
  
  // æ–°æ‰‹å°ˆå±¬æŠ˜æ‰£
  newUserDiscount: {
    percentage: 15; // é¦–5ç­†è¨‚å–®85æŠ˜
    maxOrders: 5;
    validityDays: 60;
  };
  
  // å„ªå…ˆæ”¯æ´
  prioritySupport: {
    dedicatedAgent: true; // å°ˆå±¬å®¢æœä»£è¡¨
    responseTime: 2; // 2å°æ™‚å…§å›æ‡‰
    duration: 30; // 30å¤©å„ªå…ˆæ”¯æ´
  };
}
```

#### æ–°é¤å»³å„ªæƒ 
```typescript
interface NewRestaurantBenefits {
  // äº¤æ˜“è²»ç”¨å„ªæƒ 
  transactionDiscount: {
    percentage: 20; // é¦–æœˆäº¤æ˜“æ‰‹çºŒè²»8æŠ˜
    duration: 30; // 30å¤©æœ‰æ•ˆæœŸ
  };
  
  // ä¾›æ‡‰å•†æ¨è–¦ç¦®åŒ…
  supplierIntroduction: {
    freeConsultation: true; // å…è²»æ¡è³¼é¡§å•è«®è©¢
    productSamples: 3; // æœ€å¤š3å€‹å…è²»æ¨£å“
    customPricing: true; // å®¢è£½åŒ–å ±åƒ¹
  };
  
  // ä¿¡ç”¨é¡åº¦å„ªæƒ 
  creditTerms: {
    extendedPayment: 45; // 45å¤©å¸³æœŸï¼ˆä¸€èˆ¬30å¤©ï¼‰
    creditLimit: 100000; // é¦–æ¬¡ä¿¡ç”¨é¡åº¦NT$10è¬
  };
}
```

### å¹³å°é»æ•¸ç³»çµ±

#### é»æ•¸ç²å¾—æ–¹å¼
```typescript
interface PointsEarning {
  referralBonus: number; // æ¨è–¦çå‹µ
  transactionCashback: number; // äº¤æ˜“å›é¥‹
  reviewBonus: number; // è©•åƒ¹çå‹µ
  loyaltyPoints: number; // å¿ èª åº¦é»æ•¸
  eventParticipation: number; // æ´»å‹•åƒèˆ‡
}
```

#### é»æ•¸ä½¿ç”¨æ–¹å¼
```typescript
interface PointsRedemption {
  transactionDiscount: {
    rate: 0.01; // 1é» = NT$0.01
    maxPercentage: 50; // æœ€å¤šæŠµæ‰£50%
  };
  platformFeeOffset: {
    rate: 0.01;
    maxMonthly: 10000; // æ¯æœˆæœ€å¤šæŠµæ‰£NT$100æ‰‹çºŒè²»
  };
  premiumFeatures: {
    advancedAnalytics: 5000; // é€²éšåˆ†æå ±è¡¨
    priorityListing: 3000; // å„ªå…ˆæ’åºæ›å…‰
    customBranding: 8000; // å®¢è£½åŒ–å“ç‰Œé é¢
  };
}
```

## ğŸ”— é—œä¿‚ç¶å®šèˆ‡ç®¡ç†æµç¨‹

### è‡ªå‹•é—œä¿‚å»ºç«‹

#### é‚€è«‹æ¥å—è§¸ç™¼æµç¨‹
```typescript
interface RelationshipEstablishment {
  // è‡ªå‹•è§¸ç™¼æ¢ä»¶
  trigger: 'invitation_accepted';
  
  // å»ºç«‹é—œä¿‚é¡å‹
  relationshipType: 'supplier_customer' | 'preferred_partner' | 'strategic_alliance';
  
  // é è¨­äº¤æ˜“æ¢ä»¶
  defaultTerms: {
    paymentTerms: number; // é è¨­å¸³æœŸ
    deliveryTerms: string; // é…é€æ¢ä»¶
    minimumOrder: number; // æœ€ä½è¨‚è³¼é‡
    discountTier: string; // æŠ˜æ‰£ç´šåˆ¥
  };
  
  // ä¿¡ä»»ç­‰ç´šç¹¼æ‰¿
  trustInheritance: {
    level: 'basic' | 'verified' | 'premium';
    creditLimit: number;
    fastTrackVerification: boolean;
  };
}
```

#### æ™ºèƒ½æ¢ä»¶è¨­å®š
```typescript
interface SmartTermsGeneration {
  // åŸºæ–¼æ¨è–¦è€…æ­·å²è³‡æ–™
  referrerHistory: {
    averageOrderValue: number;
    paymentRecord: 'excellent' | 'good' | 'fair';
    disputeRate: number;
  };
  
  // è¡Œæ¥­æ¨™æº–å°ç…§
  industryBenchmarks: {
    standardPaymentTerms: number;
    typicalMinimumOrder: number;
    marketDiscountRange: [number, number];
  };
  
  // ç”Ÿæˆå»ºè­°æ¢ä»¶
  suggestedTerms: {
    paymentTerms: number;
    creditLimit: number;
    discountPercentage: number;
    specialConditions: string[];
  };
}
```

### é—œä¿‚ç¶­è­·æ©Ÿåˆ¶

#### é—œä¿‚å¥åº·åº¦ç›£æ§
```typescript
interface RelationshipHealth {
  // äº¤æ˜“æ´»èºåº¦
  transactionFrequency: {
    ordersPerMonth: number;
    averageOrderValue: number;
    growthTrend: 'increasing' | 'stable' | 'decreasing';
  };
  
  // æ»¿æ„åº¦æŒ‡æ¨™
  satisfactionMetrics: {
    orderFulfillmentRate: number; // è¨‚å–®å®Œæˆç‡
    deliveryOnTimeRate: number; // æº–æ™‚äº¤ä»˜ç‡
    qualityRating: number; // å“è³ªè©•åˆ†
    serviceRating: number; // æœå‹™è©•åˆ†
  };
  
  // å¥åº·åº¦è©•åˆ†
  healthScore: number; // 0-100åˆ†
  riskLevel: 'low' | 'medium' | 'high';
  recommendations: string[];
}
```

#### é—œä¿‚å„ªåŒ–å»ºè­°
```typescript
interface RelationshipOptimization {
  // åŸºæ–¼æ•¸æ“šåˆ†æçš„å»ºè­°
  suggestions: {
    orderOptimization: string[]; // è¨‚è³¼å„ªåŒ–å»ºè­°
    priceNegotiation: string[]; // åƒ¹æ ¼è«‡åˆ¤å»ºè­°
    serviceImprovement: string[]; // æœå‹™æ”¹å–„å»ºè­°
  };
  
  // è‡ªå‹•åŒ–å„ªåŒ–é¸é …
  automatedActions: {
    priceAlerts: boolean; // åƒ¹æ ¼ç•°å¸¸æé†’
    inventorySync: boolean; // åº«å­˜åŒæ­¥
    autoReorder: boolean; // è‡ªå‹•è£œå–®
  };
}
```

## ğŸ·ï¸ é‚€è«‹ç¢¼/é€£çµç³»çµ±

### é‚€è«‹ç¢¼ç”Ÿæˆèˆ‡ç®¡ç†

#### ç¢¼æ ¼å¼è¦ç¯„ï¼ˆæ“´å±•ç¾æœ‰8ä½åˆ¶ï¼‰
```typescript
interface InviteCodeFormat {
  // ç¾æœ‰æ ¼å¼ä¿æŒï¼ˆå‘å¾Œå…¼å®¹ï¼‰
  legacy: {
    format: 'XXXXXXXX'; // 8ä½è‹±æ•¸å­—
    example: 'AB12CD34';
  };
  
  // æ–°å¢æ ¼å¼é¸é …
  enhanced: {
    format: 'XXX-XXX-XXX'; // åˆ†çµ„ä¾¿æ–¼è¨˜æ†¶
    example: 'ABC-123-DEF';
    checksum: boolean; // æª¢æŸ¥ç¢¼é˜²å½
  };
  
  // ç‰¹æ®Šå ´æ™¯æ ¼å¼
  bulk: {
    format: 'BULK-XXXX-XX'; // æ‰¹é‡é‚€è«‹å°ˆç”¨
    example: 'BULK-2024-01';
    batchSize: number;
  };
}
```

#### é‚€è«‹ç¢¼ç”Ÿå‘½é€±æœŸç®¡ç†
```typescript
interface InviteCodeLifecycle {
  // ç”Ÿæˆéšæ®µ
  creation: {
    timestamp: Date;
    createdBy: string;
    initialStatus: 'active';
    expiryDays: number; // é è¨­30å¤©
  };
  
  // ä½¿ç”¨éšæ®µ
  usage: {
    viewedAt?: Date;
    clickedAt?: Date;
    registrationStarted?: Date;
    registrationCompleted?: Date;
  };
  
  // çµ‚æ­¢éšæ®µ
  termination: {
    status: 'expired' | 'used' | 'cancelled' | 'suspended';
    terminatedAt: Date;
    reason?: string;
  };
}
```

### å¤šæ¸ é“åˆ†äº«æ©Ÿåˆ¶

#### åˆ†äº«æ¸ é“æ•´åˆ
```typescript
interface SharingChannels {
  // Email åˆ†äº«
  email: {
    templateType: 'formal' | 'casual' | 'promotional';
    customMessage: boolean;
    attachments: ['company_intro', 'product_catalog'];
  };
  
  // Line åˆ†äº«
  line: {
    messageType: 'text' | 'flex_message' | 'rich_menu';
    qrCodeGeneration: boolean;
    groupSharing: boolean;
  };
  
  // QR Code ç”Ÿæˆ
  qrCode: {
    size: 'small' | 'medium' | 'large';
    logoEmbedding: boolean;
    downloadFormats: ['png', 'svg', 'pdf'];
  };
  
  // ç¤¾ç¾¤åª’é«”
  socialMedia: {
    platforms: ['facebook', 'instagram', 'linkedin'];
    autoPosting: boolean;
    hashtagSuggestions: string[];
  };
}
```

#### å‹•æ…‹é€£çµç”Ÿæˆ
```typescript
interface DynamicLinkGeneration {
  // åŸºç¤ URL çµæ§‹
  baseUrl: 'https://orderly.tw/invite';
  
  // åƒæ•¸çµ„æˆ
  parameters: {
    code: string; // é‚€è«‹ç¢¼
    ref: string; // æ¨è–¦äººID
    type: 'supplier' | 'restaurant'; // é‚€è«‹é¡å‹
    campaign?: string; // è¡ŒéŠ·æ´»å‹•æ¨™è­˜
    utm_source?: string; // æµé‡ä¾†æº
    utm_medium?: string; // åª’ä»‹é¡å‹
    utm_campaign?: string; // æ´»å‹•åç¨±
  };
  
  // å‹•æ…‹å…§å®¹
  dynamicContent: {
    previewTitle: string; // é€£çµé è¦½æ¨™é¡Œ
    previewDescription: string; // é€£çµé è¦½æè¿°
    previewImage: string; // é€£çµé è¦½åœ–ç‰‡
    fallbackUrl: string; // é™ç´šé€£çµ
  };
}
```

## ğŸ“Š æˆæ•ˆè¿½è¹¤èˆ‡åˆ†æç³»çµ±

### æ¨è–¦æ¼æ–—åˆ†æ

#### è½‰æ›æµç¨‹è¿½è¹¤
```typescript
interface ReferralFunnel {
  // ç¬¬1éšæ®µï¼šé‚€è«‹ç™¼é€
  invitationSent: {
    totalSent: number;
    channelBreakdown: Record<string, number>;
    targetAudience: string;
  };
  
  // ç¬¬2éšæ®µï¼šé‚€è«‹æŸ¥çœ‹
  invitationViewed: {
    totalViewed: number;
    viewRate: number; // viewed/sent
    avgTimeToView: number; // å°æ™‚
  };
  
  // ç¬¬3éšæ®µï¼šé»æ“Šé€£çµ
  linkClicked: {
    totalClicks: number;
    clickRate: number; // clicked/viewed
    bounceRate: number; // ç«‹å³é›¢é–‹ç‡
  };
  
  // ç¬¬4éšæ®µï¼šé–‹å§‹è¨»å†Š
  registrationStarted: {
    totalStarted: number;
    conversionRate: number; // started/clicked
    dropOffPoints: string[]; // æµå¤±ç¯€é»
  };
  
  // ç¬¬5éšæ®µï¼šå®Œæˆè¨»å†Š
  registrationCompleted: {
    totalCompleted: number;
    completionRate: number; // completed/started
    avgRegistrationTime: number; // åˆ†é˜
  };
  
  // ç¬¬6éšæ®µï¼šé¦–æ¬¡äº¤æ˜“
  firstTransaction: {
    totalTransacted: number;
    activationRate: number; // transacted/completed
    avgTimeToFirstOrder: number; // å¤©
  };
}
```

#### ç—…æ¯’ä¿‚æ•¸è¨ˆç®—
```typescript
interface ViralityMetrics {
  // Kå› å­è¨ˆç®—ï¼ˆç—…æ¯’ä¿‚æ•¸ï¼‰
  kFactor: {
    formula: 'invitationsSentPerUser * conversionRate';
    invitationsSentPerUser: number; // æ¯ç”¨æˆ¶å¹³å‡ç™¼é€é‚€è«‹æ•¸
    conversionRate: number; // é‚€è«‹è½‰æ›ç‡
    kValue: number; // Kå€¼ï¼ˆ>1è¡¨ç¤ºç—…æ¯’å¼å¢é•·ï¼‰
  };
  
  // ä¸–ä»£åˆ†æ
  cohortAnalysis: {
    generation: number; // æ¨è–¦ä¸–ä»£ï¼ˆç¬¬å¹¾ä»£ç”¨æˆ¶ï¼‰
    size: number; // è©²ä¸–ä»£ç”¨æˆ¶æ•¸é‡
    acquisitionCost: number; // è©²ä¸–ä»£ç²å®¢æˆæœ¬
    lifetimeValue: number; // è©²ä¸–ä»£ç”Ÿå‘½é€±æœŸåƒ¹å€¼
  };
  
  // ç¶²çµ¡æ•ˆæ‡‰æ¸¬é‡
  networkEffect: {
    nodes: number; // ç¶²çµ¡ç¯€é»æ•¸ï¼ˆç”¨æˆ¶æ•¸ï¼‰
    edges: number; // ç¶²çµ¡é‚Šæ•¸ï¼ˆé—œä¿‚æ•¸ï¼‰
    density: number; // ç¶²çµ¡å¯†åº¦
    centralityMeasures: Record<string, number>; // ä¸­å¿ƒæ€§æ¸¬é‡
  };
}
```

### ROI è©•ä¼°èˆ‡æ­¸å› åˆ†æ

#### æ¨è–¦æ¸ é“ ROI è¨ˆç®—
```typescript
interface ChannelROI {
  // æˆæœ¬è¨ˆç®—
  costs: {
    systemDevelopment: number; // ç³»çµ±é–‹ç™¼æˆæœ¬
    rewardPayouts: number; // çå‹µæ”¯å‡º
    operationalCosts: number; // ç‡Ÿé‹æˆæœ¬
    marketingSupport: number; // è¡ŒéŠ·æ”¯æ´æˆæœ¬
  };
  
  // æ”¶ç›Šè¨ˆç®—
  revenue: {
    transactionCommission: number; // äº¤æ˜“ä½£é‡‘
    subscriptionFees: number; // è¨‚é–±è²»ç”¨
    valueAddedServices: number; // å¢å€¼æœå‹™
    lifetimeValue: number; // ç”¨æˆ¶ç”Ÿå‘½é€±æœŸåƒ¹å€¼
  };
  
  // ROI æŒ‡æ¨™
  metrics: {
    roi: number; // (æ”¶ç›Š-æˆæœ¬)/æˆæœ¬
    paybackPeriod: number; // å›æœ¬æœŸï¼ˆæœˆï¼‰
    marginContribution: number; // é‚Šéš›è²¢ç»
  };
}
```

#### æ­¸å› æ¨¡å‹è¨­è¨ˆ
```typescript
interface AttributionModel {
  // é¦–æ¬¡æ¥è§¸æ­¸å› 
  firstTouch: {
    weight: 100; // 100%æ­¸å› çµ¦é¦–æ¬¡æ¨è–¦
    useCase: 'å“ç‰ŒèªçŸ¥æ¸¬é‡';
  };
  
  // æœ€å¾Œæ¥è§¸æ­¸å› 
  lastTouch: {
    weight: 100; // 100%æ­¸å› çµ¦æœ€çµ‚æ¨è–¦
    useCase: 'è½‰æ›æ•ˆæœæ¸¬é‡';
  };
  
  // ç·šæ€§æ­¸å› 
  linear: {
    weight: 'equal'; // å¹³å‡åˆ†é…çµ¦æ‰€æœ‰æ¥è§¸é»
    useCase: 'æ•´é«”å®¢æˆ¶æ—…ç¨‹åˆ†æ';
  };
  
  // æ™‚é–“è¡°æ¸›æ­¸å› 
  timeDecay: {
    weight: 'exponential_decay'; // è¶Šè¿‘æœŸçš„æ¥è§¸é»æ¬Šé‡è¶Šé«˜
    halfLife: 7; // 7å¤©åŠè¡°æœŸ
    useCase: 'è¿‘æœŸæ´»å‹•æ•ˆæœæ¸¬é‡';
  };
}
```

### A/B æ¸¬è©¦æ¡†æ¶

#### æ¸¬è©¦è¨­è¨ˆç¯„æœ¬
```typescript
interface ABTestDesign {
  // æ¸¬è©¦å‡è¨­
  hypothesis: {
    primary: string; // ä¸»è¦å‡è¨­
    secondary: string[]; // æ¬¡è¦å‡è¨­
    nullHypothesis: string; // é›¶å‡è¨­
  };
  
  // æ¸¬è©¦è®Šæ•¸
  variables: {
    independent: string[]; // è‡ªè®Šæ•¸ï¼ˆæ¸¬è©¦è®Šæ•¸ï¼‰
    dependent: string[]; // å› è®Šæ•¸ï¼ˆæ¸¬é‡æŒ‡æ¨™ï¼‰
    controlled: string[]; // æ§åˆ¶è®Šæ•¸
  };
  
  // å¯¦é©—è¨­è¨ˆ
  design: {
    testType: 'simple' | 'multivariate' | 'split_url';
    sampleSize: number; // æ¨£æœ¬å¤§å°
    testDuration: number; // æ¸¬è©¦æœŸé–“ï¼ˆå¤©ï¼‰
    trafficSplit: Record<string, number>; // æµé‡åˆ†é…
    significanceLevel: 0.05; // é¡¯è‘—æ€§æ°´æº–
    powerLevel: 0.8; // çµ±è¨ˆåŠŸæ•ˆ
  };
}
```

#### æ¸¬è©¦æ¡ˆä¾‹è¦åŠƒ
```typescript
interface TestCases {
  // é‚€è«‹è¨Šæ¯å„ªåŒ–
  invitationMessage: {
    control: 'æ¨™æº–é‚€è«‹è¨Šæ¯';
    variants: [
      'å€‹æ€§åŒ–é‚€è«‹ï¼ˆå«æ¨è–¦åŸå› ï¼‰',
      'ç·Šè¿«æ„Ÿé‚€è«‹ï¼ˆé™æ™‚å„ªæƒ ï¼‰',
      'ç¤¾æœƒè­‰æ˜é‚€è«‹ï¼ˆæˆåŠŸæ¡ˆä¾‹ï¼‰'
    ];
    metric: 'invitation_acceptance_rate';
  };
  
  // çå‹µé‡‘é¡æ¸¬è©¦
  rewardAmount: {
    control: 'NT$500 å¹³å°é»æ•¸';
    variants: [
      'NT$300 å¹³å°é»æ•¸',
      'NT$1000 å¹³å°é»æ•¸',
      'é¦–ç­†äº¤æ˜“2%å›é¥‹'
    ];
    metric: 'referral_participation_rate';
  };
  
  // è¨»å†Šæµç¨‹å„ªåŒ–
  onboardingFlow: {
    control: 'æ¨™æº–5æ­¥é©Ÿæµç¨‹';
    variants: [
      'ç°¡åŒ–3æ­¥é©Ÿæµç¨‹',
      'å¼•å°å¼æ™ºèƒ½æµç¨‹',
      'ä¸€é å¼å¿«é€Ÿè¨»å†Š'
    ];
    metric: 'registration_completion_rate';
  };
}
```

## ğŸ’» æŠ€è¡“å¯¦ä½œè¦æ ¼

### API ç«¯é»è¨­è¨ˆ

#### æ¨è–¦ç®¡ç† APIs
```typescript
// å‰µå»ºé‚€è«‹
POST /api/referrals/invitations
{
  invitationType: 'supplier_to_restaurant' | 'restaurant_to_supplier';
  targets: InvitationTarget[];
  message?: string;
  specialOffers?: SpecialOffer[];
  expiryDays?: number;
}

// æŸ¥çœ‹é‚€è«‹åˆ—è¡¨
GET /api/referrals/invitations
Query: {
  status?: 'pending' | 'viewed' | 'accepted' | 'expired';
  dateRange?: [string, string];
  limit?: number;
  offset?: number;
}

// é‚€è«‹çµ±è¨ˆåˆ†æ
GET /api/referrals/analytics
Query: {
  timeframe: 'daily' | 'weekly' | 'monthly';
  metrics: string[];
  groupBy?: string;
}

// çå‹µæŸ¥è©¢
GET /api/referrals/rewards
Response: {
  totalEarned: number;
  pendingRewards: RewardItem[];
  rewardHistory: RewardTransaction[];
  pointsBalance: number;
}

// å…Œæ›çå‹µ
POST /api/referrals/rewards/redeem
{
  rewardType: 'points' | 'discount' | 'cashback';
  amount: number;
  targetAccount?: string;
}
```

#### é—œä¿‚ç®¡ç† APIs
```typescript
// å»ºç«‹æ¥­å‹™é—œä¿‚
POST /api/relationships
{
  type: 'supplier_customer' | 'preferred_partner';
  counterpartyId: string;
  terms: BusinessTerms;
  sourceType: 'referral' | 'direct' | 'platform_match';
  sourceId?: string;
}

// é—œä¿‚å¥åº·åº¦æª¢æŸ¥
GET /api/relationships/{relationshipId}/health
Response: {
  healthScore: number;
  metrics: HealthMetrics;
  trends: TrendAnalysis;
  recommendations: string[];
}

// æ›´æ–°é—œä¿‚æ¢ä»¶
PUT /api/relationships/{relationshipId}/terms
{
  paymentTerms?: number;
  creditLimit?: number;
  discountTier?: string;
  specialConditions?: string[];
}
```

### è³‡æ–™åº« Schema è¨­è¨ˆ

#### æ¨è–¦ç³»çµ±æ ¸å¿ƒè¡¨
```sql
-- é‚€è«‹è¨˜éŒ„è¡¨
CREATE TABLE referral_invitations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  code VARCHAR(20) UNIQUE NOT NULL,
  inviter_id UUID NOT NULL REFERENCES users(id),
  inviter_type VARCHAR(20) NOT NULL, -- 'restaurant' | 'supplier'
  invitee_type VARCHAR(20) NOT NULL, -- 'restaurant' | 'supplier'
  invitee_email VARCHAR(255) NOT NULL,
  invitee_company_name VARCHAR(255),
  invitee_contact_person VARCHAR(255),
  invitation_message TEXT,
  special_offers JSONB DEFAULT '{}',
  status VARCHAR(20) DEFAULT 'pending',
  expires_at TIMESTAMP WITH TIME ZONE,
  sent_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  viewed_at TIMESTAMP WITH TIME ZONE,
  accepted_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- çå‹µç³»çµ±è¡¨
CREATE TABLE referral_rewards (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  invitation_id UUID REFERENCES referral_invitations(id),
  reward_type VARCHAR(50) NOT NULL, -- 'registration_bonus' | 'first_order' | 'ongoing'
  reward_amount DECIMAL(10,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'TWD',
  points_awarded INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'pending', -- 'pending' | 'paid' | 'cancelled'
  earned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  paid_at TIMESTAMP WITH TIME ZONE,
  transaction_id UUID REFERENCES transactions(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æ¥­å‹™é—œä¿‚è¡¨
CREATE TABLE business_relationships (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  supplier_id UUID NOT NULL REFERENCES suppliers(id),
  restaurant_id UUID NOT NULL REFERENCES restaurants(id),
  relationship_type VARCHAR(30) NOT NULL,
  source_type VARCHAR(20) NOT NULL, -- 'referral' | 'direct' | 'platform_match'
  source_invitation_id UUID REFERENCES referral_invitations(id),
  terms JSONB DEFAULT '{}',
  status VARCHAR(20) DEFAULT 'active',
  health_score INTEGER DEFAULT 70,
  last_interaction TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(supplier_id, restaurant_id)
);

-- æ¨è–¦è¿½è¹¤è¡¨
CREATE TABLE referral_tracking (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  invitation_id UUID NOT NULL REFERENCES referral_invitations(id),
  event_type VARCHAR(50) NOT NULL, -- 'sent' | 'viewed' | 'clicked' | 'registered' | 'transacted'
  event_data JSONB DEFAULT '{}',
  user_agent TEXT,
  ip_address INET,
  utm_source VARCHAR(255),
  utm_medium VARCHAR(255),
  utm_campaign VARCHAR(255),
  occurred_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å¹³å°é»æ•¸è¡¨
CREATE TABLE user_points (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  points_balance INTEGER DEFAULT 0,
  lifetime_earned INTEGER DEFAULT 0,
  lifetime_spent INTEGER DEFAULT 0,
  last_transaction_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id)
);

-- é»æ•¸äº¤æ˜“è¨˜éŒ„è¡¨
CREATE TABLE points_transactions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  transaction_type VARCHAR(20) NOT NULL, -- 'earn' | 'spend' | 'expire'
  points_change INTEGER NOT NULL, -- æ­£æ•¸ç‚ºç²å¾—ï¼Œè² æ•¸ç‚ºæ¶ˆè²»
  balance_after INTEGER NOT NULL,
  source_type VARCHAR(50) NOT NULL, -- 'referral' | 'cashback' | 'redemption' | 'promotion'
  source_id UUID, -- é—œè¯çš„æ¨è–¦ã€äº¤æ˜“ç­‰ID
  description TEXT,
  metadata JSONB DEFAULT '{}',
  expires_at TIMESTAMP WITH TIME ZONE, -- é»æ•¸åˆ°æœŸæ™‚é–“
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### ç´¢å¼•è¨­è¨ˆ
```sql
-- æ•ˆèƒ½å„ªåŒ–ç´¢å¼•
CREATE INDEX idx_referral_invitations_inviter ON referral_invitations(inviter_id);
CREATE INDEX idx_referral_invitations_code ON referral_invitations(code);
CREATE INDEX idx_referral_invitations_status ON referral_invitations(status);
CREATE INDEX idx_referral_invitations_expires ON referral_invitations(expires_at);

CREATE INDEX idx_referral_rewards_user ON referral_rewards(user_id);
CREATE INDEX idx_referral_rewards_status ON referral_rewards(status);
CREATE INDEX idx_referral_rewards_earned_date ON referral_rewards(earned_at);

CREATE INDEX idx_business_relationships_supplier ON business_relationships(supplier_id);
CREATE INDEX idx_business_relationships_restaurant ON business_relationships(restaurant_id);
CREATE INDEX idx_business_relationships_health ON business_relationships(health_score);

CREATE INDEX idx_referral_tracking_invitation ON referral_tracking(invitation_id);
CREATE INDEX idx_referral_tracking_event_type ON referral_tracking(event_type);
CREATE INDEX idx_referral_tracking_occurred ON referral_tracking(occurred_at);

CREATE INDEX idx_points_transactions_user ON points_transactions(user_id);
CREATE INDEX idx_points_transactions_type ON points_transactions(transaction_type);
CREATE INDEX idx_points_transactions_created ON points_transactions(created_at);
```

### å‰ç«¯çµ„ä»¶è¨­è¨ˆ

#### æ¨è–¦å„€è¡¨æ¿é é¢
```typescript
// components/referral/ReferralDashboard.tsx
interface ReferralDashboardProps {
  userType: 'restaurant' | 'supplier';
}

interface ReferralStats {
  totalInvitationsSent: number;
  successfulReferrals: number;
  totalRewardsEarned: number;
  pendingRewards: number;
  conversionRate: number;
  ranking: {
    position: number;
    totalParticipants: number;
  };
}

// ä¸»è¦åŠŸèƒ½çµ„ä»¶
const ReferralDashboard = ({ userType }: ReferralDashboardProps) => {
  // çµ±è¨ˆè³‡æ–™é¡¯ç¤º
  // è¿‘æœŸæ¨è–¦æ´»å‹•
  // çå‹µæ­·å²
  // æ¨è–¦æ’è¡Œæ¦œ
  // å¿«é€Ÿé‚€è«‹å…¥å£
};
```

#### é‚€è«‹å‰µå»ºè¡¨å–®
```typescript
// components/referral/InvitationCreator.tsx
interface InvitationFormData {
  invitationType: 'bulk' | 'single';
  targets: InvitationTarget[];
  customMessage: string;
  specialOffers: SpecialOffer[];
  expiryDays: number;
  sharingChannels: string[];
}

const InvitationCreator = () => {
  // ç›®æ¨™é¸æ“‡å™¨
  // è¨Šæ¯å®¢è£½åŒ–
  // å„ªæƒ è¨­å®š
  // åˆ†äº«æ¸ é“é¸æ“‡
  // é è¦½èˆ‡ç™¼é€
};
```

#### é—œä¿‚ç®¡ç†ä»‹é¢
```typescript
// components/relationships/RelationshipManager.tsx
interface RelationshipCardProps {
  relationship: BusinessRelationship;
  onUpdateTerms: (terms: BusinessTerms) => void;
  onViewAnalytics: () => void;
}

const RelationshipManager = () => {
  // é—œä¿‚åˆ—è¡¨å±•ç¤º
  // å¥åº·åº¦ç›£æ§
  // å¿«é€Ÿæ“ä½œé¸å–®
  // æ¢ä»¶ç·¨è¼¯åŠŸèƒ½
  // åˆ†æå ±è¡¨é€£çµ
};
```

### ç‹€æ…‹ç®¡ç†æ¶æ§‹

#### Zustand Store è¨­è¨ˆ
```typescript
// stores/referralStore.ts
interface ReferralStore {
  // ç‹€æ…‹
  invitations: ReferralInvitation[];
  rewards: RewardItem[];
  relationships: BusinessRelationship[];
  analytics: ReferralAnalytics;
  
  // è¼‰å…¥ç‹€æ…‹
  loading: {
    invitations: boolean;
    rewards: boolean;
    analytics: boolean;
  };
  
  // æ“ä½œæ–¹æ³•
  createInvitation: (data: InvitationFormData) => Promise<void>;
  loadInvitations: (filter?: InvitationFilter) => Promise<void>;
  acceptInvitation: (code: string) => Promise<void>;
  redeemRewards: (amount: number) => Promise<void>;
  updateRelationship: (id: string, terms: BusinessTerms) => Promise<void>;
  loadAnalytics: (timeframe: string) => Promise<void>;
}

// stores/pointsStore.ts
interface PointsStore {
  balance: number;
  transactions: PointsTransaction[];
  redemptionOptions: RedemptionOption[];
  
  loadBalance: () => Promise<void>;
  earnPoints: (amount: number, source: string) => Promise<void>;
  spendPoints: (amount: number, target: string) => Promise<void>;
  loadTransactionHistory: () => Promise<void>;
}
```

## ğŸ“Š å¯¦æ–½å„ªå…ˆç´šèˆ‡æ™‚ç¨‹

### Phase 1ï¼šæ ¸å¿ƒæ¨è–¦åŠŸèƒ½ï¼ˆç¬¬1-3é€±ï¼‰
**å„ªå…ˆç´šï¼šP0 - æ ¸å¿ƒåŠŸèƒ½**

#### Week 1-2ï¼šåŸºç¤æ¶æ§‹
- è³‡æ–™åº« schema è¨­è¨ˆèˆ‡å»ºç«‹
- åŸºç¤ API ç«¯é»é–‹ç™¼
- é‚€è«‹ç¢¼ç”Ÿæˆèˆ‡é©—è­‰ç³»çµ±
- ä¾›æ‡‰å•†â†’é¤å»³é‚€è«‹æµç¨‹

#### Week 3ï¼šå‰ç«¯ä»‹é¢
- æ¨è–¦å„€è¡¨æ¿é é¢
- é‚€è«‹å‰µå»ºè¡¨å–®
- é‚€è«‹é©—è­‰é é¢
- åŸºç¤çµ±è¨ˆé¡¯ç¤º

### Phase 2ï¼šçå‹µç³»çµ±ï¼ˆç¬¬4-5é€±ï¼‰
**å„ªå…ˆç´šï¼šP1 - é‡è¦åŠŸèƒ½**

#### Week 4ï¼šé»æ•¸ç³»çµ±
- å¹³å°é»æ•¸æ©Ÿåˆ¶
- çå‹µè¨ˆç®—é‚è¼¯
- é»æ•¸äº¤æ˜“è¨˜éŒ„
- å…Œæ›åŠŸèƒ½å¯¦ä½œ

#### Week 5ï¼šçå‹µåˆ†ç™¼
- è‡ªå‹•çå‹µè§¸ç™¼
- æ‰‹å‹•çå‹µèª¿æ•´
- çå‹µçµ±è¨ˆå ±è¡¨
- ç¨…å‹™è™•ç†é‚è¼¯

### Phase 3ï¼šé—œä¿‚ç®¡ç†ï¼ˆç¬¬6-7é€±ï¼‰
**å„ªå…ˆç´šï¼šP1 - é‡è¦åŠŸèƒ½**

#### Week 6ï¼šé—œä¿‚å»ºç«‹
- è‡ªå‹•é—œä¿‚ç¶å®š
- é è¨­æ¢ä»¶è¨­å®š
- ä¿¡ä»»ç­‰ç´šç¹¼æ‰¿
- é—œä¿‚ç‹€æ…‹ç®¡ç†

#### Week 7ï¼šé—œä¿‚å„ªåŒ–
- å¥åº·åº¦ç›£æ§
- æ™ºèƒ½å»ºè­°ç³»çµ±
- æ¢ä»¶å„ªåŒ–å·¥å…·
- é—œä¿‚åˆ†æå ±è¡¨

### Phase 4ï¼šåˆ†æèˆ‡å„ªåŒ–ï¼ˆç¬¬8-10é€±ï¼‰
**å„ªå…ˆç´šï¼šP2 - å¢å€¼åŠŸèƒ½**

#### Week 8-9ï¼šæ•¸æ“šåˆ†æ
- æ¨è–¦æ¼æ–—è¿½è¹¤
- ç—…æ¯’ä¿‚æ•¸è¨ˆç®—
- ROI åˆ†æå ±è¡¨
- æ­¸å› æ¨¡å‹å¯¦ä½œ

#### Week 10ï¼šA/B æ¸¬è©¦
- æ¸¬è©¦æ¡†æ¶å»ºç«‹
- å¯¦é©—è¨­è¨ˆå·¥å…·
- çµæœåˆ†æç³»çµ±
- è‡ªå‹•åŒ–æ±ºç­–

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### åŠŸèƒ½æ¸¬è©¦

#### æ¨è–¦æµç¨‹æ¸¬è©¦
```typescript
describe('Referral Flow Tests', () => {
  test('Supplier can create restaurant invitation', async () => {
    // æ¸¬è©¦ä¾›æ‡‰å•†å‰µå»ºé¤å»³é‚€è«‹
    // é©—è­‰é‚€è«‹ç¢¼ç”Ÿæˆ
    // ç¢ºèªé‚€è«‹è³‡æ–™å„²å­˜
  });
  
  test('Restaurant can accept supplier invitation', async () => {
    // æ¸¬è©¦é¤å»³æ¥å—é‚€è«‹
    // é©—è­‰è¨»å†Šæµç¨‹
    // ç¢ºèªé—œä¿‚å»ºç«‹
  });
  
  test('Rewards are correctly calculated and distributed', async () => {
    // æ¸¬è©¦çå‹µè¨ˆç®—é‚è¼¯
    // é©—è­‰åˆ†ç™¼æ©Ÿåˆ¶
    // ç¢ºèªé»æ•¸æ›´æ–°
  });
});
```

#### é‚Šç•Œæ¢ä»¶æ¸¬è©¦
```typescript
describe('Edge Cases', () => {
  test('Expired invitation handling', async () => {
    // æ¸¬è©¦éæœŸé‚€è«‹è™•ç†
  });
  
  test('Duplicate invitation prevention', async () => {
    // æ¸¬è©¦é‡è¤‡é‚€è«‹é˜²ç¯„
  });
  
  test('Maximum reward limits', async () => {
    // æ¸¬è©¦çå‹µä¸Šé™æ§åˆ¶
  });
});
```

### æ•ˆèƒ½æ¸¬è©¦

#### è² è¼‰æ¸¬è©¦å ´æ™¯
```typescript
interface LoadTestScenarios {
  // é«˜ä¸¦ç™¼é‚€è«‹å‰µå»º
  concurrentInvitations: {
    users: 1000;
    invitationsPerUser: 10;
    duration: '5 minutes';
  };
  
  // å¤§é‡é‚€è«‹æ¥å—
  massAcceptance: {
    simultaneousAcceptances: 500;
    targetResponseTime: '< 2 seconds';
  };
  
  // çå‹µè¨ˆç®—å£“åŠ›æ¸¬è©¦
  rewardCalculation: {
    transactions: 10000;
    complexRules: true;
    targetProcessingTime: '< 30 seconds';
  };
}
```

### å®‰å…¨æ¸¬è©¦

#### å®‰å…¨æ¸¬è©¦é‡é»
```typescript
interface SecurityTests {
  // é‚€è«‹ç¢¼å®‰å…¨
  inviteCodeSecurity: {
    bruteForceProtection: boolean;
    rateLimit: '10 attempts per minute';
    codeComplexity: 'sufficient entropy';
  };
  
  // çå‹µç³»çµ±å®‰å…¨
  rewardSecurity: {
    duplicatePreventions: boolean;
    fraudDetection: boolean;
    amountValidation: boolean;
  };
  
  // æ¬Šé™æ§åˆ¶
  accessControl: {
    roleBasedAccess: boolean;
    dataIsolation: boolean;
    auditLogging: boolean;
  };
}
```

## ğŸ“ˆ æˆæ•ˆè©•ä¼°èˆ‡ KPI ç›£æ§

### æ ¸å¿ƒæŒ‡æ¨™å„€è¡¨æ¿

#### å³æ™‚ç›£æ§æŒ‡æ¨™
```typescript
interface RealTimeMetrics {
  // æ¨è–¦æ´»å‹•æŒ‡æ¨™
  referralActivity: {
    invitationsSentToday: number;
    acceptanceRateToday: number;
    activeInvitations: number;
    expiringInvitations: number;
  };
  
  // ç³»çµ±å¥åº·æŒ‡æ¨™
  systemHealth: {
    apiResponseTime: number;
    errorRate: number;
    databaseConnections: number;
    cacheHitRate: number;
  };
  
  // æ¥­å‹™å¥åº·æŒ‡æ¨™
  businessHealth: {
    newRelationshipsToday: number;
    rewardsDistributedToday: number;
    userEngagementRate: number;
    revenueFromReferrals: number;
  };
}
```

#### æ¯æ—¥ç‡Ÿé‹å ±è¡¨
```typescript
interface DailyOperationalReport {
  // æ¨è–¦çµ±è¨ˆ
  referralStats: {
    totalInvitationsSent: number;
    totalAccepted: number;
    conversionRate: number;
    topPerformers: ReferralLeader[];
  };
  
  // çå‹µçµ±è¨ˆ
  rewardStats: {
    totalRewardsEarned: number;
    totalRewardsPaid: number;
    pendingRewards: number;
    topEarners: RewardEarner[];
  };
  
  // é—œä¿‚çµ±è¨ˆ
  relationshipStats: {
    newRelationships: number;
    totalActiveRelationships: number;
    averageHealthScore: number;
    relationshipsAtRisk: number;
  };
}
```

### é•·æœŸè¶¨å‹¢åˆ†æ

#### æœˆåº¦æˆé•·åˆ†æ
```typescript
interface MonthlyGrowthAnalysis {
  // ç”¨æˆ¶æˆé•·
  userGrowth: {
    organicSignups: number;
    referralSignups: number;
    referralPercentage: number;
    monthOverMonthGrowth: number;
  };
  
  // æ”¶ç›Šæˆé•·
  revenueGrowth: {
    totalRevenue: number;
    referralRevenue: number;
    revenuePerReferral: number;
    roiImprovement: number;
  };
  
  // ç¶²çµ¡æ•ˆæ‡‰
  networkEffect: {
    totalConnections: number;
    averageConnectionsPerUser: number;
    networkDensity: number;
    viralCoefficient: number;
  };
}
```

### é è­¦ç³»çµ±

#### è‡ªå‹•å‘Šè­¦è¦å‰‡
```typescript
interface AlertRules {
  // æ•ˆèƒ½å‘Šè­¦
  performance: {
    conversionRateDropBelow: 15; // è½‰æ›ç‡ä½æ–¼15%
    responseTimeExceeds: 5000; // å›æ‡‰æ™‚é–“è¶…é5ç§’
    errorRateExceeds: 2; // éŒ¯èª¤ç‡è¶…é2%
  };
  
  // æ¥­å‹™å‘Šè­¦
  business: {
    dailyInvitationsDropBelow: 10; // æ¯æ—¥é‚€è«‹æ•¸å°‘æ–¼10
    rewardPayoutExceeds: 50000; // æ¯æ—¥çå‹µè¶…éNT$50,000
    fraudSuspicionScore: 0.8; // æ¬ºè©æ‡·ç–‘åˆ†æ•¸è¶…é0.8
  };
  
  // ç³»çµ±å‘Šè­¦
  system: {
    databaseConnectionIssue: true;
    thirdPartyServiceDown: true;
    unusualTrafficPattern: true;
  };
}
```

## ğŸš€ ä¸Šç·šéƒ¨ç½²è¨ˆåŠƒ

### åˆ†éšæ®µä¸Šç·šç­–ç•¥

#### Phase 1ï¼šå…§æ¸¬ç‰ˆæœ¬ï¼ˆç¬¬1é€±ï¼‰
- **ç›®æ¨™ç”¨æˆ¶**ï¼šå…§éƒ¨å“¡å·¥å’Œç¨®å­ç”¨æˆ¶ï¼ˆ50äººï¼‰
- **åŠŸèƒ½ç¯„åœ**ï¼šåŸºç¤æ¨è–¦æµç¨‹ã€ç°¡å–®çå‹µæ©Ÿåˆ¶
- **æˆåŠŸæ¨™æº–**ï¼šåŠŸèƒ½æ­£å¸¸é‹ä½œï¼Œç„¡é‡å¤§bug
- **ç›£æ§é‡é»**ï¼šç³»çµ±ç©©å®šæ€§ã€åŸºç¤åŠŸèƒ½é©—è­‰

#### Phase 2ï¼šé‚€è«‹åˆ¶æ¸¬è©¦ï¼ˆç¬¬2-3é€±ï¼‰
- **ç›®æ¨™ç”¨æˆ¶**ï¼šå‹å¥½å®¢æˆ¶å’Œåˆä½œå¤¥ä¼´ï¼ˆ200äººï¼‰
- **åŠŸèƒ½ç¯„åœ**ï¼šå®Œæ•´æ¨è–¦åŠŸèƒ½ã€çå‹µç³»çµ±
- **æˆåŠŸæ¨™æº–**ï¼šè½‰æ›ç‡>10%ï¼Œç”¨æˆ¶åé¥‹æ­£é¢
- **ç›£æ§é‡é»**ï¼šç”¨æˆ¶è¡Œç‚ºã€è½‰æ›æ•ˆæœ

#### Phase 3ï¼šé™é‡å…¬æ¸¬ï¼ˆç¬¬4-5é€±ï¼‰
- **ç›®æ¨™ç”¨æˆ¶**ï¼šéš¨æ©Ÿé¸å–çš„ç¾æœ‰ç”¨æˆ¶ï¼ˆ20%æµé‡ï¼‰
- **åŠŸèƒ½ç¯„åœ**ï¼šå…¨éƒ¨åŠŸèƒ½åŒ…å«åˆ†æå ±è¡¨
- **æˆåŠŸæ¨™æº–**ï¼šé”åˆ°é æœŸKPIçš„70%
- **ç›£æ§é‡é»**ï¼šè¦æ¨¡åŒ–æ•ˆæœã€ç³»çµ±è² è¼‰

#### Phase 4ï¼šå…¨é‡ä¸Šç·šï¼ˆç¬¬6é€±é–‹å§‹ï¼‰
- **ç›®æ¨™ç”¨æˆ¶**ï¼šæ‰€æœ‰ç”¨æˆ¶ï¼ˆ100%æµé‡ï¼‰
- **åŠŸèƒ½ç¯„åœ**ï¼šå®Œæ•´åŠŸèƒ½é›†åˆ
- **æˆåŠŸæ¨™æº–**ï¼šé”åˆ°ç›®æ¨™KPIï¼Œç³»çµ±ç©©å®š
- **ç›£æ§é‡é»**ï¼šæ¥­å‹™æŒ‡æ¨™ã€é•·æœŸå½±éŸ¿

### é¢¨éšªç·©è§£è¨ˆåŠƒ

#### æŠ€è¡“é¢¨éšªç·©è§£
```typescript
interface TechnicalRiskMitigation {
  // ç³»çµ±éè¼‰
  systemOverload: {
    loadBalancing: true;
    autoScaling: true;
    circuitBreaker: true;
    gracefulDegradation: true;
  };
  
  // è³‡æ–™å®Œæ•´æ€§
  dataIntegrity: {
    transactionRollback: true;
    dataValidation: true;
    backupStrategy: true;
    consistencyChecks: true;
  };
  
  // ç¬¬ä¸‰æ–¹ä¾è³´
  thirdPartyDependency: {
    fallbackMechanisms: true;
    timeoutHandling: true;
    retryLogic: true;
    alternativeProviders: true;
  };
}
```

#### æ¥­å‹™é¢¨éšªç·©è§£
```typescript
interface BusinessRiskMitigation {
  // æ¬ºè©é˜²ç¯„
  fraudPrevention: {
    patternDetection: true;
    velocityChecks: true;
    manualReview: true;
    blacklistManagement: true;
  };
  
  // æˆæœ¬æ§åˆ¶
  costControl: {
    dailyLimits: true;
    approvalWorkflow: true;
    budgetAlerts: true;
    emergencyStop: true;
  };
  
  // ç”¨æˆ¶é«”é©—
  userExperience: {
    progressiveRollout: true;
    userFeedbackLoop: true;
    rapidIteration: true;
    supportEscalation: true;
  };
}
```

## ğŸ“‹ å¾ŒçºŒè¿­ä»£èˆ‡æ“´å±•

### çŸ­æœŸå„ªåŒ–ï¼ˆä¸Šç·šå¾Œ1-3å€‹æœˆï¼‰

#### ç”¨æˆ¶é«”é©—å„ªåŒ–
- **å€‹æ€§åŒ–æ¨è–¦**ï¼šåŸºæ–¼ç”¨æˆ¶è¡Œç‚ºå’Œåå¥½çš„æ™ºèƒ½æ¨è–¦
- **çå‹µå¤šæ¨£åŒ–**ï¼šç¾é‡‘å›é¥‹ã€æœå‹™å‡ç´šã€å°ˆå±¬åŠŸèƒ½
- **åˆ†äº«ä¾¿åˆ©æ€§**ï¼šä¸€éµåˆ†äº«ã€ç¤¾ç¾¤æ•´åˆã€ç—…æ¯’å¼å‚³æ’­

#### é‹ç‡Ÿå·¥å…·å®Œå–„
- **æ¨è–¦æ´»å‹•ç®¡ç†**ï¼šå­£ç¯€æ€§æ¨è–¦æ´»å‹•ã€ä¸»é¡Œæ¨å»£
- **æ•ˆæœè¿½è¹¤å„ªåŒ–**ï¼šæ›´ç²¾ç´°çš„æ­¸å› åˆ†æã€é æ¸¬æ¨¡å‹
- **å®¢æœæ•´åˆ**ï¼šæ¨è–¦ç›¸é—œå•é¡Œçš„å°ˆé–€æ”¯æ´

### ä¸­æœŸç™¼å±•ï¼ˆ3-6å€‹æœˆï¼‰

#### æŠ€è¡“èƒ½åŠ›æå‡
- **AI æ¨è–¦å¼•æ“**ï¼šæ©Ÿå™¨å­¸ç¿’å„ªåŒ–æ¨è–¦åŒ¹é…
- **é æ¸¬åˆ†æ**ï¼šç”¨æˆ¶è¡Œç‚ºé æ¸¬ã€æµå¤±é¢¨éšªé è­¦
- **è‡ªå‹•åŒ–é‹ç‡Ÿ**ï¼šæ™ºèƒ½æ¨è–¦è§¸ç™¼ã€å‹•æ…‹çå‹µèª¿æ•´

#### ç”Ÿæ…‹ç³»çµ±æ“´å±•
- **åˆä½œå¤¥ä¼´æ¨è–¦**ï¼šç‰©æµã€é‡‘èã€æŠ€è¡“æœå‹™å•†
- **è·¨å¹³å°æ•´åˆ**ï¼šç¤¾ç¾¤åª’é«”ã€é€šè¨Šè»Ÿé«”ã€ç¬¬ä¸‰æ–¹ç³»çµ±
- **åœ‹éš›åŒ–æº–å‚™**ï¼šå¤šèªè¨€ã€å¤šå¹£ç¨®ã€è·¨å¢ƒæ¨è–¦

### é•·æœŸé¡˜æ™¯ï¼ˆ6-12å€‹æœˆï¼‰

#### å¹³å°ç”Ÿæ…‹å»ºè¨­
- **æ¨è–¦è€…ç¤¾ç¾¤**ï¼šæ¨è–¦è€…å°ˆå±¬ç¤¾ç¾¤ã€ç¶“é©—åˆ†äº«ã€æ’è¡Œç«¶è³½
- **æ•¸æ“šæœå‹™**ï¼šæ¨è–¦æ•ˆæœåˆ†æã€å¸‚å ´æ´å¯Ÿã€è¡Œæ¥­å ±å‘Š
- **é‡‘èæ•´åˆ**ï¼šä¾›æ‡‰éˆé‡‘èã€æ¨è–¦æ“”ä¿ã€é¢¨éšªå…±æ“”

#### å‰µæ–°æ¨¡å¼æ¢ç´¢
- **å€å¡Šéˆæ‡‰ç”¨**ï¼šå»ä¸­å¿ƒåŒ–æ¨è–¦ã€æ™ºèƒ½åˆç´„åŸ·è¡Œ
- **IoT æ•´åˆ**ï¼šè¨­å‚™è‡ªå‹•æ¨è–¦ã€ä½¿ç”¨æ•¸æ“šé©…å‹•
- **å…ƒå®‡å®™ä½ˆå±€**ï¼šè™›æ“¬å±•ç¤ºã€æ²‰æµ¸å¼é«”é©—

---

**æ–‡æª”ç‰ˆæœ¬**ï¼š1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-01-20  
**è² è²¬äºº**ï¼šç”¢å“åœ˜éšŠ  
**å¯©æ ¸ç‹€æ…‹**ï¼šå¾…å¯©æ ¸  
**ç›¸é—œæ–‡æª”**ï¼šPRD-Onboarding-Process.md